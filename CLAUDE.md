# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Qalam is a stateless Quran translation learning application. Users practice translating Quranic verses and receive AI-powered feedback. The app has no user authentication or databaseâ€”all data is served from static JSON files.

## Common Commands

```bash
npm run dev              # Start development server (localhost:3000)
npm run build            # Build for production
npm run lint             # Run ESLint
npm run build:quran      # Build quran.json from Tanzil.net source files
npm run seed:analysis    # Generate verse analysis via Ollama (requires quran.json)
```

## Architecture

### Tech Stack
- **Framework**: Next.js 16 with App Router
- **Language**: TypeScript (strict mode)
- **Styling**: Tailwind CSS with custom Islamic-themed colors (teal primary, gold accents)
- **Fonts**: Amiri for Arabic text (RTL), system fonts for UI

### Key Directories
- `src/app/` - Next.js App Router pages
- `src/components/ui/` - Reusable UI components (Button, Card, Input, Alert, Spinner)
- `src/components/` - Feature components (Navbar, VerseDisplay, FeedbackCard)
- `src/lib/data.ts` - Data fetching utilities for static JSON
- `src/types/` - TypeScript definitions for linguistic analysis, verses, feedback
- `public/data/` - Static JSON data (surahs, verses, pre-computed analysis)
- `scripts/` - Utility scripts including Ollama-based analysis seeder

### Data Architecture

**Source Data (human-verified, from Tanzil.net):**
- `public/data/quran.json` - Complete Quran with Arabic text + translations
- Built from source files in `public/data/`:
  - `quran-simple.txt` - Arabic text
  - `en.sahih.txt` - Sahih International English translation
  - `en.transliteration.txt` - Transliteration
  - `surahs.json` - Surah metadata
- Run `npm run build:quran` to regenerate
- To add new translations: edit `TRANSLATIONS` array in `scripts/build-quran-json.ts`

**Analysis Data (LLM-generated):**
- `public/data/analysis/{surah}-{verse}.json` - Word-by-word linguistic analysis
- Generated by seed script using Ollama/LM Studio
- References verse text from quran.json (never duplicates source)

**Key Principle:** Arabic text and translations are NEVER generated by LLM. Only linguistic analysis is AI-generated. This ensures Quranic text accuracy.

### Data Flow
1. `quran.json` is the source of truth for all verse text (Arabic + translations)
2. `src/lib/data.ts` provides fetch utilities with client-side caching
3. Analysis files contain only linguistic breakdowns, referencing quran.json for verse text
4. Verse IDs use "surah:verse" format (e.g., "1:5" for Surah 1, Verse 5)

### Important Types (src/types/index.ts)
- `QuranData` - Complete quran.json structure (meta + surahs array)
- `QuranSurah` - Surah with verses from quran.json
- `QuranVerse` - Verse with arabic + translations object (en.sahih, en.transliteration)
- `Surah` - Surah metadata (id, name, nameArabic, meaning, verseCount, revelationType)
- `VerseAnalysis` - Complete word-by-word linguistic analysis (roots, grammar, morphology)
- `WordAnalysis` - Detailed breakdown of each word
- `AttemptFeedback` - LLM evaluation results (score, correct/missed elements, suggestions)

### LLM Integration
- Uses Ollama locally for verse analysis generation
- Environment variables: `OLLAMA_BASE_URL` (default: http://localhost:11434), `OLLAMA_MODEL` (default: llama3.2, recommended: qwen2.5:72b)
- Seed script at `scripts/seed-analysis.ts` generates analysis files with resume capability

### Design System
- Primary color: Teal (#14b8a6) - Islamic aesthetic
- Secondary color: Gold (#f59e0b) - accents
- Arabic text uses `font-arabic` class with custom `text-arabic-*` sizes
- RTL support via `dir="rtl"` and `lang="ar"` attributes

## Development Notes

- Path alias: `@/*` maps to `./src/*`
- Arabic text sourced from Tanzil.net (quran-simple edition)
- All 114 surahs with 6236 verses available in quran.json
- Analysis files are generated incrementally via seed script
